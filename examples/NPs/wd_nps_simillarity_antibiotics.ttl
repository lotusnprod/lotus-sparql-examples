@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix ex: <https://lotus.nprod.net/lotus-sparql-examples/NPs/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix schema: <https://schema.org/> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix spex: <https://purl.expasy.org/sparql-examples/ontology#> .

<https://purl.example.32_wd_nps_simillarity_antibiotics> a sh:SPARQLExecutable;
  rdfs:comment " How many compounds are structurally similar to compounds labeled as antibiotics? Results are grouped by the parent taxon of the organism they were found in.",
    """title: How many compounds are structurally similar to compounds labeled as antibiotics? Results are grouped by the parent taxon of the organism they were found in.
 prefixes needed for structural similarity search""";
  rdfs:label " Natural products structurally similar to labels";
  sh:prefixes _:sparql_examples_prefixes;
  sh:select """PREFIX hint: http://www.bigdata.com/queryHints#
PREFIX idsm: https://idsm.elixir-czech.cz/sparql/endpoint/
PREFIX sachem: http://bioinfo.uochb.cas.cz/rdf/v1.0/sachem#
PREFIX wdt: http://www.wikidata.org/prop/direct/
PREFIX xsd: http://www.w3.org/2001/XMLSchema#
PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX hint: <http://www.bigdata.com/queryHints#>
PREFIX sachem: <http://bioinfo.uochb.cas.cz/rdf/v1.0/sachem#>
PREFIX idsm: <https://idsm.elixir-czech.cz/sparql/endpoint/>
SELECT ?parent_taxon ?parent_taxon_name (COUNT(DISTINCT ?compound) AS ?count) WHERE {
    SERVICE idsm:wikidata {
        VALUES ?CUTOFF {
            \"0.9\"^^xsd:double
        }
        SERVICE <https://query.wikidata.org/bigdata/namespace/wdq/sparql> {
            VALUES ?MESH {
                \"D000900\"
            }
            ?antibiotic ((wdt:P279*)/wdt:P2868/wdt:P486) ?MESH;
            wdt:P233 ?smiles.
        }
        ?compound sachem:similarCompoundSearch[
        sachem:query ?smiles;
        sachem:cutoff ?CUTOFF
        ].
    } hint:Prior hint:runFirst TRUE.
    ?compound wdt:P703/wdt:P171 ?parent_taxon.
    ?parent_taxon wdt:P225 ?parent_taxon_name.
}
GROUP BY ?parent_taxon ?parent_taxon_name
ORDER BY DESC (?count)""";
  schema:keywords "Natural products", "Structural similarity";
  schema:target " https://query.wikidata.org/bigdata/namespace/wdq/sparql" .
